# Test lazy loading behavior - index not loaded on creation, loaded after first access

build table-format=Pebble,v3 bloom-filter
a.SET.1:A
b.SET.2:B
c.SET.3:C
d.SET.4:D
e.SET.5:E
----

iter-lazy
check-index-loaded
----
index-loaded: false

iter-lazy
first
check-index-loaded
----
first: <a:1>:A
index-loaded: true

iter-lazy
check-index-loaded
seek-ge c
check-index-loaded
----
index-loaded: false
seek-ge c: <c:3>:C
index-loaded: true

iter-lazy
check-index-loaded
last
check-index-loaded
----
index-loaded: false
last: <e:5>:E
index-loaded: true

iter-lazy
check-index-loaded
seek-lt d
check-index-loaded
----
index-loaded: false
seek-lt d: <c:3>:C
index-loaded: true

# Test with column blocks format
build table-format=Pebble,v5 bloom-filter
f.SET.6:F
g.SET.7:G
h.SET.8:H
i.SET.9:I
j.SET.10:J
----

iter-lazy
check-index-loaded
----
index-loaded: false

iter-lazy
first
check-index-loaded
----
first: <f:6>:F
index-loaded: true

iter-lazy
check-index-loaded
seek-ge h
check-index-loaded
----
index-loaded: false
seek-ge h: <h:8>:H
index-loaded: true

# Test bloom filter optimization - index might not be loaded for misses
build table-format=Pebble,v3 bloom-filter
k.SET.11:K
l.SET.12:L
m.SET.13:M
----

iter-lazy
check-index-loaded
seek-prefix-ge nonexistent_key nonexistent_key
check-index-loaded
----
index-loaded: false
seek-prefix-ge nonexistent_key: .
index-loaded: false

iter-lazy
check-index-loaded
seek-prefix-ge k k
check-index-loaded
----
index-loaded: false
seek-prefix-ge k: <k:11>:K
index-loaded: true
