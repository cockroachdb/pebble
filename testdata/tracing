build
set hello foo
----

# The first 3 reads are for initializing the Reader, which don't use
# cache.Handle.GetWithReadHandle, while the remaining do. For the latter,
# cache misses result in deterministic 5ms of wait time and 5ms of read time.
get
hello
----
reading footer of 61 bytes took 5ms
reading block kind metadata of 37 bytes took 5ms (<redacted>)
reading block kind metadata of 311 bytes took 5ms (<redacted>)
reading block kind index of 31 bytes took 5ms + 5ms wait (<redacted>)
reading block kind data of 32 bytes took 5ms + 5ms wait (<redacted>)
hello:foo

# If we disable background tracing, we should see no traces with Get.
get disable-background-tracing
hello
----
hello:foo

iter
seek-ge hello
----
reading block kind index of 31 bytes took 5ms + 5ms wait (<redacted>)
reading block kind data of 32 bytes took 5ms + 5ms wait (<redacted>)
hello: (foo, .)

snapshot-iter
seek-ge hello
----
reading block kind index of 31 bytes took 5ms + 5ms wait (<redacted>)
reading block kind data of 32 bytes took 5ms + 5ms wait (<redacted>)
hello: (foo, .)

indexed-batch-iter
seek-ge hello
----
reading block kind index of 31 bytes took 5ms + 5ms wait (<redacted>)
reading block kind data of 32 bytes took 5ms + 5ms wait (<redacted>)
hello: (foo, .)

build
set hello@2 foo1
range-key-set a z @4 foo2
----

# This operation should not read the range key block.
#
# The first 3 reads are for initializing the Reader, which don't use
# cache.Handle.GetWithReadHandle, while the remaining do. For the latter,
# cache misses result in deterministic 5ms of wait time and 5ms of read time.
get
hello@2
----
reading footer of 61 bytes took 5ms
reading block kind metadata of 62 bytes took 5ms (<redacted>)
reading block kind metadata of 380 bytes took 5ms (<redacted>)
reading block kind index of 27 bytes took 5ms + 5ms wait (<redacted>)
reading block kind data of 35 bytes took 5ms + 5ms wait (<redacted>)
hello@2:foo1

# These operations should read the range key block, which shows up as a third
# log.
iter
seek-ge hello
next
----
reading block kind index of 27 bytes took 5ms + 5ms wait (<redacted>)
reading block kind data of 35 bytes took 5ms + 5ms wait (<redacted>)
reading block kind rangekey of 35 bytes took 5ms + 5ms wait (<redacted>)
hello: (., [a-z) @4=foo2 UPDATED)
hello@2: (foo1, [a-z) @4=foo2)

snapshot-iter
seek-ge hello
next
----
reading block kind index of 27 bytes took 5ms + 5ms wait (<redacted>)
reading block kind data of 35 bytes took 5ms + 5ms wait (<redacted>)
reading block kind rangekey of 35 bytes took 5ms + 5ms wait (<redacted>)
hello: (., [a-z) @4=foo2 UPDATED)
hello@2: (foo1, [a-z) @4=foo2)

indexed-batch-iter
seek-ge hello
next
----
reading block kind index of 27 bytes took 5ms + 5ms wait (<redacted>)
reading block kind data of 35 bytes took 5ms + 5ms wait (<redacted>)
reading block kind rangekey of 35 bytes took 5ms + 5ms wait (<redacted>)
hello: (., [a-z) @4=foo2 UPDATED)
hello@2: (foo1, [a-z) @4=foo2)
