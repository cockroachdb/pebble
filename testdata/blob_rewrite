init write-new-blob-files minimum-size=5
----

add
bar#201,SET:poi
bax#202,SET:blob{value=yaya}
----
# create: 000001.sst
RawWriter.Add("bar#201,SET", "poi", false)
RawWriter.Add("bax#202,SET", "yaya", false)

add
baz#202,SET:blob{value=yuumi}
foo#209,SET:poiandyaya
----
# create: 000002.blob
RawWriter.AddWithBlobHandle("baz#202,SET", "(f0,blk0,id0,len5)", 0, false)
RawWriter.AddWithBlobHandle("foo#209,SET", "(f0,blk0,id1,len10)", 0, false)

close-output
----
# sync-data: 000001.sst
# close: 000001.sst
# sync-data: 000002.blob
# close: 000002.blob
Blob file created: 000002 size:[105 (105B)] vals:[15 (15B)]
{BlockCount: 1, ValueCount: 2, UncompressedValueBytes: 15, FileLen: 105}
blobrefs:[
 0: B000002 15
]

init preserve-blob-references
B000001 physical:{000001 size:[903530] vals:[39531]}
B000002 physical:{000002 size:[82530] vals:[72111]}
B000003 physical:{000003 size:[192542] vals:[85225]}
----

add
a#9,SET:blob{fileNum=000001 value=darcy}
a#5,SET:blob{fileNum=000003 value=tani}
b#2,DEL:
c#9,SET:paddy
----
# create: 000004.sst
RawWriter.AddWithBlobHandle("a#9,SET", "(f0,blk0,id0,len5)", 5, false)
RawWriter.AddWithBlobHandle("a#5,SET", "(f1,blk0,id0,len4)", 4, false)
RawWriter.Add("b#2,DEL", "", false)
RawWriter.Add("c#9,SET", "paddy", false)

close-output
----
# sync-data: 000004.sst
# close: 000004.sst
no blob file created
blobrefs:[
 0: B000001 5
 1: B000003 4
]

rewrite-blob 000001 000004 000001
----
# create: 000005.blob
rewrite error: file 000005 type mismatch (known type blob, expected type sstable)
