example
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0      216 B |    101 102 B |    101   103 |  114 B  114 B |  104 B |    112 104 B |   1  4.31
    1      416 B |    201 202 B |    201   203 |  214 B  214 B |  204 B |    212 204 B |   2  4.16
    2      616 B |    301 302 B |    301   303 |  314 B  314 B |  304 B |    312 304 B |   3  4.11
    3      816 B |    401 402 B |    401   403 |  414 B  414 B |  404 B |    412 404 B |   4  4.08
    4      1 KiB |    501 502 B |    501   503 |  514 B  514 B |  504 B |    512 504 B |   5  4.06
    5    1.2 KiB |    601 602 B |    601   603 |  614 B  614 B |  604 B |    612 604 B |   6  4.05
total    1.4 KiB |    701 702 B |    701   703 |  714 B  714 B |  704 B |    712 704 B |   7  4.05
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |  1.10  2.10  0.30 |    113 106 B | 104 B 104 B 104 B |  107 B 117 B |    221  217 B  231 B
    1 |  1.20  2.20  0.60 |    213 206 B | 204 B 204 B 204 B |  207 B 217 B |    421  417 B  431 B
    2 |  1.30  2.30  0.90 |    313 306 B | 304 B 304 B 304 B |  307 B 317 B |    621  617 B  631 B
    3 |  1.40  2.40  1.20 |    413 406 B | 404 B 404 B 404 B |  407 B 417 B |    821  817 B  831 B
    4 |  1.50  2.50  1.50 |    513 506 B | 504 B 504 B 504 B |  507 B 517 B |    1 K  1 KiB  1 KiB
    5 |  1.60  2.60  1.80 |    613 606 B | 604 B 604 B 604 B |  607 B 617 B |  1.2 K 1.2 Ki 1.2 KiB
total |     0  2.70  2.10 |    713 706 B | 704 B 704 B 704 B |  707 B 717 B |  1.4 K 1.4 Ki 1.4 KiB
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |        27       28       29       30       31       16       32       33       34        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
 22 (24B) |   25B: 26B |      4.0% |         8 |   12 (11B) |   14 (13B) |        51 |    36 (34B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
      2 (1B) |       42.9% |    180 (17B) |       48.7% |        47.4% |          21 |           4
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   31 pending | 2.0MB (1) |  15B (16) |       30B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
         15KB |         9.0KB |          4.0KB |           2.0KB |           3.0KB |         5.0KB
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               6B |            2 (7B) |         3 (3.0KB) |                 5 |                2!!
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
             123 |              456 |                    789!! |           1.0KB |           2.0KB
--------------------------------------------------------------------------------------------------
COMPRESSION
  minlz:  32
  snappy: 33
  zstd:   34
  none:   35

init
----

batch
set a 1
----

iter-new a category=a
----

flush
----
L0.0:
  000005:[a#10,SET-a#10,SET]

# iter b references both a memtable and sstable 5.

iter-new b category=b
----

metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0      756 B |      1 756 B |      0     0 |    0 B    0 B |   28 B |      0   0 B |   1 27.00
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0  0.25  0.25 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      1  756 B    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         0        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   17B: 28B |     64.7% |         1 |  1 (256KB) |  1 (256KB) |        45 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
    2 (747B) |        0.0% |     1 (280B) |        0.0% |         0.0% |           1 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 1
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:112 BlockBytesInCache:0 BlockReadDuration:10ms}

disk-usage
----
3.7KB

batch
set b 2
----

flush
----
L0.0:
  000005:[a#10,SET-a#10,SET]
  000007:[b#11,SET-b#11,SET]

# iter c references both a memtable and sstables 5 and 7.

iter-new c category=c
----

# Two files, since the target file size is set to 50.

compact a-z
----
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]

metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0        0 B |      0   0 B |      0     0 |    0 B    0 B |   64 B |      0   0 B |   0 23.62
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    1.5 KiB |      2 1.5 K |      0     0 |    0 B    0 B | 1.5 Ki |      0   0 B |   1  1.01
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      2 1.5 Ki    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B |  224 B   0 B |      2 1.5 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         1        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   34B: 64B |     88.2% |         2 |  1 (256KB) |  2 (512KB) |        98 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
    2 (747B) |       33.3% |     2 (560B) |       66.7% |         0.0% |           2 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) | 1.5KB (2) |     1.5KB |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 2
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:224 BlockBytesInCache:112 BlockReadDuration:10ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:112 BlockBytesInCache:0 BlockReadDuration:10ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}

disk-usage
----
6.1KB

# Closing iter a will release one of the zombie memtables.

iter-close a
----

metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0        0 B |      0   0 B |      0     0 |    0 B    0 B |   64 B |      0   0 B |   0 23.62
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    1.5 KiB |      2 1.5 K |      0     0 |    0 B    0 B | 1.5 Ki |      0   0 B |   1  1.01
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      2 1.5 Ki    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B |  224 B   0 B |      2 1.5 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         1        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   34B: 64B |     88.2% |         2 |  1 (256KB) |  2 (512KB) |        98 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
    2 (747B) |       33.3% |     2 (560B) |       66.7% |         0.0% |           2 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) | 1.5KB (2) |     1.5KB |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 2
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:224 BlockBytesInCache:112 BlockReadDuration:10ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:112 BlockBytesInCache:0 BlockReadDuration:10ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}

# Closing iter c will release one of the zombie sstables. The other
# zombie sstable is still referenced by iter b.

iter-close c
----

metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0        0 B |      0   0 B |      0     0 |    0 B    0 B |   64 B |      0   0 B |   0 23.62
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    1.5 KiB |      2 1.5 K |      0     0 |    0 B    0 B | 1.5 Ki |      0   0 B |   1  1.01
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      2 1.5 Ki    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B |  224 B   0 B |      2 1.5 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         1        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   34B: 64B |     88.2% |         2 |  1 (256KB) |  2 (512KB) |        98 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
    2 (747B) |       33.3% |     1 (280B) |       66.7% |         0.0% |           1 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |  756B (1) |      756B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 2
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:224 BlockBytesInCache:112 BlockReadDuration:10ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:112 BlockBytesInCache:0 BlockReadDuration:10ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}

disk-usage
----
5.3KB

# Closing iter b will release the last zombie sstable and the last zombie memtable.

iter-close b
----

metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0        0 B |      0   0 B |      0     0 |    0 B    0 B |   64 B |      0   0 B |   0 23.62
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    1.5 KiB |      2 1.5 K |      0     0 |    0 B    0 B | 1.5 Ki |      0   0 B |   1  1.01
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      2 1.5 Ki    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B |  224 B   0 B |      2 1.5 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         1        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   34B: 64B |     88.2% |         2 |  1 (256KB) |  1 (256KB) |        98 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
      0 (0B) |       33.3% |       0 (0B) |       66.7% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 2
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:224 BlockBytesInCache:112 BlockReadDuration:10ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:112 BlockBytesInCache:0 BlockReadDuration:10ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}

disk-usage
----
4.6KB

additional-metrics
----
block bytes written:
 __level___data-block__value-block
      0         162B           0B
      1           0B           0B
      2           0B           0B
      3           0B           0B
      4           0B           0B
      5           0B           0B
      6         168B           0B

batch
set c@20 c20
set c@19 c19
set c@18 c18
set c@17 c17
set c@16 c16
set c@15 c15
set c@14 c14
----

flush
----
L0.0:
  000011:[c@20#12,SET-c@20#12,SET]
  000013:[c@19#13,SET-c@19#13,SET]
  000015:[c@18#14,SET-c@18#14,SET]
  000017:[c@17#15,SET-c@17#15,SET]
  000019:[c@16#16,SET-c@16#16,SET]
  000021:[c@15#17,SET-c@15#17,SET]
  000023:[c@14#18,SET-c@14#18,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
Blob files:
  B000012 physical:{000012 size:[92 (92B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[92 (92B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[92 (92B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[92 (92B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[92 (92B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[92 (92B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[92 (92B)] vals:[3 (3B)]}

metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0    6.5 KiB |      7 5.9 K |      0     0 |  644 B    0 B |  165 B |      0   0 B |   1 53.45
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    1.5 KiB |      2 1.5 K |      0     0 |    0 B    0 B | 1.5 Ki |      0   0 B |   1  1.01
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0  0.25  0.25 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      9 7.4 Ki 1.3 KiB
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B |  224 B   0 B |      2 1.5 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         1        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 116B: 165B |     42.2% |         3 |  1 (256KB) |  1 (256KB) |       281 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
      0 (0B) |       33.3% |       0 (0B) |       66.7% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B | 7 (644B |   0 (0B) |    21B |    21B |    100%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            8.0KB |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 9
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:224 BlockBytesInCache:112 BlockReadDuration:10ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:112 BlockBytesInCache:0 BlockReadDuration:10ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}

additional-metrics
----
block bytes written:
 __level___data-block__value-block
      0         827B           0B
      1           0B           0B
      2           0B           0B
      3           0B           0B
      4           0B           0B
      5           0B           0B
      6         168B           0B

compact a-z
----
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
Blob files:
  B000012 physical:{000012 size:[92 (92B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[92 (92B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[92 (92B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[92 (92B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[92 (92B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[92 (92B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[92 (92B)] vals:[3 (3B)]}

metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0        0 B |      0   0 B |      0     0 |    0 B    0 B |  165 B |      0   0 B |   0 53.45
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total      8 KiB |      9 7.4 K |      0     0 |  644 B    0 B | 7.4 Ki |      0   0 B |   1  1.00
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      9 7.4 Ki 1.3 KiB
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B | 1.1 Ki   0 B |      9 7.4 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         2        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 116B: 165B |     42.2% |         3 |  1 (256KB) |  1 (256KB) |       281 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
      0 (0B) |       10.0% |       0 (0B) |       55.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B | 7 (644B |   0 (0B) |    21B |    21B |    100%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 9
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:1106 BlockBytesInCache:112 BlockReadDuration:80ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:112 BlockBytesInCache:0 BlockReadDuration:10ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}

additional-metrics
----
block bytes written:
 __level___data-block__value-block
      0         827B           0B
      1           0B           0B
      2           0B           0B
      3           0B           0B
      4           0B           0B
      5           0B           0B
      6         818B           0B

# Flushable ingestion metrics. This requires there be data in a memtable that
# would overlap with the ingested table(s). Delayed flushes are disabled here to
# prevent the ingestion from immediately triggering a flush of the memtable.
# Instead, we wish to flush manually _after_ the ingestion of the two tables has
# completed, linking the two tables into the flushable queue.

delay-flush
enable
----

batch
set d d
set e e
set f f
----

build ext1.sst
set d d
----

build ext2.sst
set e e
----

ingest ext1.sst ext2.sst
----

build ext3.sst
set f f
----

ingest ext3.sst
----

delay-flush
disable
----

flush
----
L0.1:
  000032:[d#22,SET-d#22,SET]
  000033:[e#23,SET-e#23,SET]
  000036:[f#24,SET-f#24,SET]
L0.0:
  000040:[d#19,SET-d#19,SET]
  000041:[e#20,SET-e#20,SET]
  000042:[f#21,SET-f#21,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
Blob files:
  B000012 physical:{000012 size:[92 (92B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[92 (92B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[92 (92B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[92 (92B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[92 (92B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[92 (92B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[92 (92B)] vals:[3 (3B)]}

# We expect the ingested-as-flushable count to be three (one for each ingested
# table). The unknown category in the iter category stats is because of a gap
# in instrumentation for checking overlap with an existing flushable ingest,
# where we open and close a point iterator when constructing a range-del
# iterator.
metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0    4.5 KiB |      6 4.5 K |      0     0 |    0 B    0 B |  211 B |      3 2.2 K |   2 52.55
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total      8 KiB |      9 7.4 K |      0     0 |  644 B    0 B | 7.4 Ki |      0   0 B |   1  1.00
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0  0.50  0.50 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |     12 9.6 Ki 1.3 KiB
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B | 1.1 Ki   0 B |      9 7.4 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         2        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 176B: 211B |     19.9% |         8 |  1 (1.0MB) |  1 (1.0MB) |       387 |   2 (2.2KB)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
   6 (2.2KB) |        7.3% |       0 (0B) |       55.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B | 7 (644B |   0 (0B) |    21B |    21B |    100%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
             12KB |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 15
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:1106 BlockBytesInCache:112 BlockReadDuration:80ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:112 BlockBytesInCache:0 BlockReadDuration:10ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}

batch
set g g
set h h
set i i
set j j
set k k
set l l
set m m
----

flush
----
L0.1:
  000032:[d#22,SET-d#22,SET]
  000033:[e#23,SET-e#23,SET]
  000036:[f#24,SET-f#24,SET]
L0.0:
  000040:[d#19,SET-d#19,SET]
  000041:[e#20,SET-e#20,SET]
  000042:[f#21,SET-f#21,SET]
  000044:[g#25,SET-g#25,SET]
  000045:[h#26,SET-h#26,SET]
  000046:[i#27,SET-i#27,SET]
  000047:[j#28,SET-j#28,SET]
  000048:[k#29,SET-k#29,SET]
  000049:[l#30,SET-l#30,SET]
  000050:[m#31,SET-m#31,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
Blob files:
  B000012 physical:{000012 size:[92 (92B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[92 (92B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[92 (92B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[92 (92B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[92 (92B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[92 (92B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[92 (92B)] vals:[3 (3B)]}

metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0    9.6 KiB |     13 9.6 K |      0     0 |    0 B    0 B |  277 B |      3 2.2 K |   2 59.13
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total      8 KiB |      9 7.4 K |      0     0 |  644 B    0 B | 7.4 Ki |      0   0 B |   1  1.00
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0  0.50  0.50 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |     19 15 KiB 1.3 KiB
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B | 1.1 Ki   0 B |      9 7.4 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         2        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 223B: 277B |     24.2% |         9 |  1 (1.0MB) |  1 (1.0MB) |       500 |   2 (2.2KB)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
   6 (2.2KB) |        7.3% |       0 (0B) |       55.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B | 7 (644B |   0 (0B) |    21B |    21B |    100%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
             18KB |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 22
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:1106 BlockBytesInCache:112 BlockReadDuration:80ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:112 BlockBytesInCache:0 BlockReadDuration:10ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}

build ext1
set z z
----

ingest-and-excise ext1 excise=i-k
----

# sstable 29, 30 were created as virtual when i-k was excised.
lsm
----
L0.1:
  000032:[d#22,SET-d#22,SET]
  000033:[e#23,SET-e#23,SET]
  000036:[f#24,SET-f#24,SET]
L0.0:
  000040:[d#19,SET-d#19,SET]
  000041:[e#20,SET-e#20,SET]
  000042:[f#21,SET-f#21,SET]
  000044:[g#25,SET-g#25,SET]
  000045:[h#26,SET-h#26,SET]
  000048:[k#29,SET-k#29,SET]
  000049:[l#30,SET-l#30,SET]
  000050:[m#31,SET-m#31,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
  000051:[z#33,SET-z#33,SET]
Blob files:
  B000012 physical:{000012 size:[92 (92B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[92 (92B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[92 (92B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[92 (92B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[92 (92B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[92 (92B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[92 (92B)] vals:[3 (3B)]}

# There should be 2 backing tables. Note that tiny sstables have inaccurate
# virtual sstable sizes.
metrics-value
num-backing
backing-size
num-virtual
num-virtual 0
virtual-size
----
0
0B
0
0
0B

metrics zero-cache-hits-misses
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0    8.1 KiB |     11 8.1 K |      0     0 |    0 B    0 B |  277 B |      3 2.2 K |   2 59.13
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    8.7 KiB |     10 8.1 K |      0     0 |  644 B    0 B | 7.4 Ki |      1 763 B |   1  1.00
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0  0.50  0.50 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |     19 15 KiB 1.3 KiB
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B | 1.1 Ki   0 B |      9 7.4 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         2        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 223B: 277B |     24.2% |         9 |  1 (1.0MB) |  1 (1.0MB) |       500 |   2 (2.2KB)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
      0 (0B) |        0.0% |       0 (0B) |        0.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B | 7 (644B |   0 (0B) |    21B |    21B |    100%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
             17KB |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 21
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:1106 BlockBytesInCache:112 BlockReadDuration:80ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:112 BlockBytesInCache:0 BlockReadDuration:10ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}

# Virtualize a virtual sstable.
build ext1
set zz zz
----

ingest-and-excise ext1 excise=k-l
----

# sstable 32 created when k-l was excised, but no new backing file should be
# created.
lsm
----
L0.1:
  000032:[d#22,SET-d#22,SET]
  000033:[e#23,SET-e#23,SET]
  000036:[f#24,SET-f#24,SET]
L0.0:
  000040:[d#19,SET-d#19,SET]
  000041:[e#20,SET-e#20,SET]
  000042:[f#21,SET-f#21,SET]
  000044:[g#25,SET-g#25,SET]
  000045:[h#26,SET-h#26,SET]
  000049:[l#30,SET-l#30,SET]
  000050:[m#31,SET-m#31,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
  000051:[z#33,SET-z#33,SET]
  000052:[zz#35,SET-zz#35,SET]
Blob files:
  B000012 physical:{000012 size:[92 (92B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[92 (92B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[92 (92B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[92 (92B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[92 (92B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[92 (92B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[92 (92B)] vals:[3 (3B)]}

metrics-value
num-backing
backing-size
num-virtual
num-virtual 0
virtual-size
----
0
0B
0
0
0B

compact a-z
----
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
  000053:[d#0,SET-d#0,SET]
  000054:[e#0,SET-e#0,SET]
  000055:[f#0,SET-f#0,SET]
  000056:[g#0,SET-g#0,SET]
  000057:[h#0,SET-h#0,SET]
  000058:[l#0,SET-l#0,SET]
  000059:[m#0,SET-m#0,SET]
  000051:[z#33,SET-z#33,SET]
  000052:[zz#35,SET-zz#35,SET]
Blob files:
  B000012 physical:{000012 size:[92 (92B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[92 (92B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[92 (92B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[92 (92B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[92 (92B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[92 (92B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[92 (92B)] vals:[3 (3B)]}

# Virtual sstables metrics should be gone after the compaction.
metrics-value
num-backing
backing-size
num-virtual
num-virtual 0
virtual-size
----
0
0B
0
0
0B

metrics zero-cache-hits-misses
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0        0 B |      0   0 B |      0     0 |    0 B    0 B |  277 B |      3 2.2 K |   0 59.13
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total     15 KiB |     18 14 Ki |      0     0 |  644 B    0 B | 15 KiB |      2 1.5 K |   1  0.85
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |     19 15 KiB 1.3 KiB
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B | 2.2 Ki   0 B |     16 13 KiB    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         3        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 223B: 277B |     24.2% |         9 |  1 (1.0MB) |  1 (1.0MB) |       500 |   2 (2.2KB)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
      0 (0B) |        0.0% |       0 (0B) |        0.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B | 7 (644B |   0 (0B) |    21B |    21B |    100%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 18
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:2235 BlockBytesInCache:457 BlockReadDuration:150ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:112 BlockBytesInCache:0 BlockReadDuration:10ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}

# Create a DB where lower levels are written as shared tables. All ingests also
# become shared tables.
init shared-lower
----

batch
set a 1
set b 1
set c 1
----

flush
----
L0.0:
  000005:[a#10,SET-a#10,SET]
  000006:[b#11,SET-b#11,SET]
  000007:[c#12,SET-c#12,SET]

# One local table.
metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0    2.2 KiB |      3 2.2 K |      0     0 |    0 B    0 B |   38 B |      0   0 B |   1 59.68
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0  0.25  0.25 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      3 2.2 Ki    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         0        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   27B: 38B |     40.7% |         1 |  1 (256KB) |  1 (256KB) |        65 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
      0 (0B) |        0.0% |       0 (0B) |        0.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 3
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}

compact a-z
----
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000010:[c#0,SET-c#0,SET]

# Table becomes shared, so local table size becomes 0.
metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0        0 B |      0   0 B |      0     0 |    0 B    0 B |   38 B |      0   0 B |   0 59.68
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    2.2 KiB |      3 2.2 K |      0     0 |    0 B    0 B | 2.2 Ki |      0   0 B |   1  1.01
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      3 2.2 Ki    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B |  336 B   0 B |      3 2.2 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         1        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   27B: 38B |     40.7% |         1 |  1 (256KB) |  1 (256KB) |        65 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
      0 (0B) |        0.0% |       0 (0B) |       50.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 3
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:336 BlockBytesInCache:0 BlockReadDuration:30ms}

build ext1.sst
set b 2
----

ingest ext1.sst
----

metrics-value
remote-count
remote-size
----
4
3.0KB

lsm
----
L0.0:
  000011:[b#13,SET-b#13,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000010:[c#0,SET-c#0,SET]

# Ingest is also shared table, so local table size stays 0.
metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0      763 B |      1 763 B |      0     0 |    0 B    0 B |   38 B |      1 763 B |   1 59.68
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    2.2 KiB |      3 2.2 K |      0     0 |    0 B    0 B | 2.2 Ki |      0   0 B |   1  1.01
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0  0.25  0.25 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      3 2.2 Ki    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B |  336 B   0 B |      3 2.2 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         1        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   27B: 38B |     40.7% |         1 |  1 (256KB) |  1 (256KB) |        65 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
    2 (739B) |        0.0% |       0 (0B) |       50.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            3.0KB |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 4
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:336 BlockBytesInCache:0 BlockReadDuration:30ms}

batch
set b 3
----

flush
----
L0.1:
  000013:[b#14,SET-b#14,SET]
L0.0:
  000011:[b#13,SET-b#13,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000010:[c#0,SET-c#0,SET]

# Local table size increases due to flush.
metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0    1.5 KiB |      2 1.5 K |      0     0 |    0 B    0 B |   74 B |      1 763 B |   2 40.86
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    2.2 KiB |      3 2.2 K |      0     0 |    0 B    0 B | 2.2 Ki |      0   0 B |   1  1.01
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0  0.50  0.50 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      4  3 KiB    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B |  336 B   0 B |      3 2.2 Ki    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         1        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   44B: 74B |     68.2% |         2 |  1 (256KB) |  1 (256KB) |       118 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
    2 (739B) |        0.0% |       0 (0B) |       50.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            3.7KB |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 5
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:336 BlockBytesInCache:0 BlockReadDuration:30ms}

# Reopen DB, to ensure stats are consistent. Also, reopened DB is not
# configured to write shared tables.
init reopen
----

metrics zero-cache-hits-misses
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0    1.5 KiB |      2 1.5 K |      0     0 |    0 B    0 B |    0 B |      0   0 B |   2     0
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    2.2 KiB |      3 2.2 K |      0     0 |    0 B    0 B |    0 B |      0   0 B |   1     0
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0  0.50  0.50 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         0        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |     0B: 0B |      0.0% |         1 |  1 (512KB) |  1 (256KB) |         0 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
      0 (0B) |        0.0% |       0 (0B) |        0.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            3.7KB |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 5
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}

compact a-z
----
L6:
  000008:[a#0,SET-a#0,SET]
  000018:[b#0,SET-b#0,SET]
  000010:[c#0,SET-c#0,SET]

# All tables are local after compaction.
metrics zero-cache-hits-misses
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    2.2 KiB |      3 2.2 K |      0     0 |    0 B    0 B | 1.5 Ki |      0   0 B |   1  0.50
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      0   0 B |   0 B   0 B   0 B |  342 B   0 B |      1  763 B    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         1        0        0        0        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |     0B: 0B |      0.0% |         1 |  1 (512KB) |  1 (256KB) |         0 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
      0 (0B) |        0.0% |       0 (0B) |        0.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 3
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:342 BlockBytesInCache:0 BlockReadDuration:30ms}

init
----

batch
set a 1
set b 2
----

flush
----
L0.0:
  000005:[a#10,SET-a#10,SET]
  000006:[b#11,SET-b#11,SET]

batch
del-sized c 500
----

flush
----
L0.0:
  000005:[a#10,SET-a#10,SET]
  000006:[b#11,SET-b#11,SET]
  000008:[c#12,DELSIZED-c#12,DELSIZED]

compact a-z parallel
----
L6:
  000005:[a#10,SET-a#10,SET]
  000006:[b#11,SET-b#11,SET]
  000008:[c#12,DELSIZED-c#12,DELSIZED]

batch
del-range a c
----

flush
----
L0.0:
  000010:[a#13,RANGEDEL-b#inf,RANGEDEL]
  000011:[b#13,RANGEDEL-c#inf,RANGEDEL]
L6:
  000005:[a#10,SET-a#10,SET]
  000006:[b#11,SET-b#11,SET]
  000008:[c#12,DELSIZED-c#12,DELSIZED]

metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0    1.5 KiB |      2 1.5 K |      0     0 |    0 B    0 B |  106 B |      0   0 B |   1 36.22
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    2.3 KiB |      3 2.3 K |      0     0 |    0 B    0 B |    0 B |      0   0 B |   1     0
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0  0.25  0.25 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      5 3.7 Ki    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      3 2.3 K |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         0        0        0        3        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |  57B: 106B |     86.0% |         3 |  1 (256KB) |  1 (256KB) |       163 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
    2 (726B) |        0.0% |     2 (560B) |        0.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            3.7KB |            0 (0B) |            0 (0B) |                 0 |                  0
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                3 |                        0 |            502B |           1.5KB
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 5
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}

problem-spans
L0 [a, c)
L6 [u, v]
----

metrics
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
    0    1.5 KiB |      2 1.5 K |      0     0 |    0 B    0 B |  106 B |      0   0 B |   1 36.22
    1        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    2        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    3        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    4        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
    5        0 B |      0   0 B |      0     0 |    0 B    0 B |    0 B |      0   0 B |   0     0
total    2.3 KiB |      3 2.3 K |      0     0 |    0 B    0 B |    0 B |      0   0 B |   1     0
--------------------------------------------------------------------------------------------------
COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
    0 |     0  0.25  0.25 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      5 3.7 Ki    0 B
    1 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    2 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    3 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    4 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
    5 |     0     0     0 |      0   0 B |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
total |     0  0.00  0.00 |      3 2.3 K |   0 B   0 B   0 B |    0 B   0 B |      0    0 B    0 B
--------------------------------------------------------------------------------------------------
kind      |   default   delete  elision     move     read     tomb  rewrite     copy    multi     blob
count     |         0        0        0        3        0        0        0        0        0        0
--------------------------------------------------------------------------------------------------
COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |  57B: 106B |     86.0% |         3 |  1 (256KB) |  1 (256KB) |       163 |      0 (0B)
--------------------------------------------------------------------------------------------------
ITERATORS
        block cache        |         file cache         |    filter    |  sst iters  |  snapshots
     entries |    hit rate |      entries |    hit rate |         util |        open |        open
-------------+-------------+--------------+-------------+--------------+-------------+------------
    2 (726B) |        0.0% |     2 (560B) |        0.0% |         0.0% |           0 |           0
--------------------------------------------------------------------------------------------------
FILES                 tables                      |     blob files     |        blob values
   stats prog |   backing |    zombie |  loc zomb |    live |   zombie |  total |  refed | refed %
--------------+-----------+-----------+-----------+---------+----------+--------+--------+--------
   all loaded |    0B (0) |    0B (0) |        0B |  0 (0B) |   0 (0B) |     0B |     0B |      0%
--------------------------------------------------------------------------------------------------
CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B
--------------------------------------------------------------------------------------------------
COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            3.7KB |            0 (0B) |            0 (0B) |                 0 |                2!!
--------------------------------------------------------------------------------------------------
KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                3 |                        0 |            502B |           1.5KB
--------------------------------------------------------------------------------------------------
COMPRESSION
  snappy: 5
Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
