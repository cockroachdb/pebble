example
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0       216B |    101  102B |    101   103 |   114B   114B |   104B |    112  104B |   1  4.31
   L1       416B |    201  202B |    201   203 |   214B   214B |   204B |    212  204B |   2  4.16
   L2       616B |    301  302B |    301   303 |   314B   314B |   304B |    312  304B |   3  4.11
   L3       816B |    401  402B |    401   403 |   414B   414B |   404B |    412  404B |   4  4.08
   L4        1KB |    501  502B |    501   503 |   514B   514B |   504B |    512  504B |   5  4.06
   L5      1.2KB |    601  602B |    601   603 |   614B   614B |   604B |    612  604B |   6  4.05
   L6      1.4KB |    701  702B |    701   703 |   714B   714B |   704B |    712  704B |   7  4.05
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      5.6KB |   2.8K 2.7KB |   2.8K  2.8K |  2.8KB  2.8KB |  2.8KB |   2.9K 2.8KB |  28  5.04

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |  1.10  2.10  0.30 |    113  106B |  104B  104B  104B |   107B  117B |    221   217B   231B
   L1 |  1.20  2.20  0.60 |    213  206B |  204B  204B  204B |   207B  217B |    421   417B   431B
   L2 |  1.30  2.30  0.90 |    313  306B |  304B  304B  304B |   307B  317B |    621   617B   631B
   L3 |  1.40  2.40  1.20 |    413  406B |  404B  404B  404B |   407B  417B |    821   817B   831B
   L4 |  1.50  2.50  1.50 |    513  506B |  504B  504B  504B |   507B  517B |     1K    1KB    1KB
   L5 |  1.60  2.60  1.80 |    613  606B |  604B  604B  604B |   607B  617B |   1.2K  1.2KB  1.2KB
   L6 |     -  2.70  2.10 |    713  706B |  704B  704B  704B |   707B  717B |   1.4K  1.4KB  1.4KB
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |   2.9K 2.8KB | 2.8KB 2.8KB 2.8KB |  2.8KB 2.9KB |   5.7K  8.4KB  5.7KB

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |      10      11       12    14    15    16       17    13     18    19      20

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
 22 (24B) |   25B: 26B |      4.0% |         8 |   12 (2GB) |   5 (13MB) |        51 |      4 (6B)

BLOCK CACHE: 100 entries (1GB)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   11% [3.3%]  | 9.1% [0.4%]  9.8% [0.5%]   11% [0.5%]   11% [0.6%]   12% [0.6%]   12% [0.7%]
  L0   17% [5.9%]  |  15% [0.9%]   16% [0.9%]    16% [1%]     17% [1%]    17% [1.1%]   18% [1.1%]
  L1   21% [8.6%]  |  20% [1.3%]   20% [1.4%]   21% [1.4%]   21% [1.4%]   22% [1.5%]   22% [1.5%]
  L2    24% [11%]  |  24% [1.8%]   24% [1.8%]   24% [1.8%]   24% [1.9%]   25% [1.9%]    25% [2%]
  L3    27% [14%]  |  26% [2.2%]   27% [2.2%]   27% [2.3%]   27% [2.3%]   27% [2.4%]   28% [2.4%]
  L4    29% [16%]  |  29% [2.6%]   29% [2.7%]   29% [2.7%]   29% [2.8%]   29% [2.8%]   30% [2.9%]
  L5    31% [19%]  |  30% [3.1%]   31% [3.1%]   31% [3.2%]   31% [3.2%]   31% [3.2%]   31% [3.3%]
  L6    32% [22%]  |  32% [3.5%]   32% [3.6%]   32% [3.6%]   32% [3.6%]   33% [3.7%]   33% [3.7%]
-------------------+------------------------------------------------------------------------------
total     25.7%    |  25% [16%]    25% [16%]    26% [16%]    26% [17%]    26% [17%]    26% [18%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
   180 (1MB) |      48.7% |       47.4% |          21 |           4

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |        live |     zombie |  total |      refed
--------------+------------+-----------------------+-------------+------------+--------+-----------
   31 pending |    1 (2MB) |  18 (17MB local:30MB) | 1.2K (15GB) |  14 (30MB) |   14GB | 79% (11GB)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
         15KB |           9KB |            4KB |             2KB |             3KB |           5KB

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
              6GB |           2 (1MB) |           3 (3KB) |                 4 |                5!!

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
             123 |              456 |                    789!! |             1MB |             2MB

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |         100MB |          10MB
       snappy |    1GB (CR=2) |   10GB (CR=2)
        minlz |    1GB (CR=3) |   10GB (CR=3)
         zstd |   10GB (CR=5) |  100GB (CR=5)
      unknown |         500MB |          50MB
----
----

init
----

batch
set a 1
----

iter-new a category=a
----

flush
----
L0.0:
  000005:[a#10,SET-a#10,SET]

# iter b references both a memtable and sstable 5.

iter-new b category=b
----

metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0       660B |      1  660B |      0     0 |     0B     0B |    28B |      0    0B |   1 23.57
-----------------+--------------+--------------+---------------+--------+--------------+----------
total       660B |      1  660B |      0     0 |     0B     0B |    28B |      0    0B |   1 24.57

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -  0.25  0.25 |      0    0B |    0B    0B    0B |     0B    0B |      1   660B     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |     0B    0B |      1   688B     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       0       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   17B: 28B |     64.7% |         1 |  1 (256KB) |  1 (256KB) |        45 |      0 (0B)

BLOCK CACHE: 2 entries (683B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [50%]  |                                                                   100% [50%]
  L0   100% [50%]  |               100% [25%]                                          100% [25%]
-------------------+------------------------------------------------------------------------------
total     100%     |               100% [25%]                                          100% [75%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
    1 (280B) |       0.0% |        0.0% |           1 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |           36B |
       snappy | 76B (CR=1.14) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:579 BlockBytesInCache:0 BlockReadDuration:30ms}
----
----

disk-usage
----
3.6KB

batch
set b 2
----

flush
----
L0.0:
  000005:[a#10,SET-a#10,SET]
  000007:[b#11,SET-b#11,SET]

# iter c references both a memtable and sstables 5 and 7.

iter-new c category=c
----

# Two files, since the target file size is set to 50.

compact a-z
----
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]

metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0         0B |      0    0B |      0     0 |     0B     0B |    64B |      0    0B |   0 20.62
   L6      1.3KB |      2 1.3KB |      0     0 |     0B     0B |  1.3KB |      0    0B |   1  0.99
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      1.3KB |      2 1.3KB |      0     0 |     0B     0B |    64B |      0    0B |   1 42.09

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -     0     0 |      0    0B |    0B    0B    0B |     0B    0B |      2  1.3KB     0B
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |   691B    0B |      2  1.3KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |   691B    0B |      4  2.6KB     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       1       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   34B: 64B |     88.2% |         2 |  1 (256KB) |  2 (512KB) |        98 |      0 (0B)

BLOCK CACHE: 2 entries (683B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [50%]  |                                                                   100% [50%]
  L0    50% [50%]  |  50% [25%]    50% [12%]                                           50% [12%]
-------------------+------------------------------------------------------------------------------
total     66.7%    |  50% [25%]    50% [12%]                                           83% [62%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
    2 (560B) |      66.7% |        0.0% |           2 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) | 2 (1.3KB local:1.3KB) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |          230B |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:691 BlockBytesInCache:112 BlockReadDuration:20ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:579 BlockBytesInCache:0 BlockReadDuration:30ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}
----
----

disk-usage
----
5.7KB

# Closing iter a will release one of the zombie memtables.

iter-close a
----

metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0         0B |      0    0B |      0     0 |     0B     0B |    64B |      0    0B |   0 20.62
   L6      1.3KB |      2 1.3KB |      0     0 |     0B     0B |  1.3KB |      0    0B |   1  0.99
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      1.3KB |      2 1.3KB |      0     0 |     0B     0B |    64B |      0    0B |   1 42.09

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -     0     0 |      0    0B |    0B    0B    0B |     0B    0B |      2  1.3KB     0B
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |   691B    0B |      2  1.3KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |   691B    0B |      4  2.6KB     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       1       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   34B: 64B |     88.2% |         2 |  1 (256KB) |  2 (512KB) |        98 |      0 (0B)

BLOCK CACHE: 2 entries (683B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [50%]  |                                                                   100% [50%]
  L0    50% [50%]  |  50% [25%]    50% [12%]                                           50% [12%]
-------------------+------------------------------------------------------------------------------
total     66.7%    |  50% [25%]    50% [12%]                                           83% [62%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
    2 (560B) |      66.7% |        0.0% |           2 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) | 2 (1.3KB local:1.3KB) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |          230B |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:691 BlockBytesInCache:112 BlockReadDuration:20ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:579 BlockBytesInCache:0 BlockReadDuration:30ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}
----
----

# Closing iter c will release one of the zombie sstables. The other
# zombie sstable is still referenced by iter b.

iter-close c
----

metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0         0B |      0    0B |      0     0 |     0B     0B |    64B |      0    0B |   0 20.62
   L6      1.3KB |      2 1.3KB |      0     0 |     0B     0B |  1.3KB |      0    0B |   1  0.99
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      1.3KB |      2 1.3KB |      0     0 |     0B     0B |    64B |      0    0B |   1 42.09

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -     0     0 |      0    0B |    0B    0B    0B |     0B    0B |      2  1.3KB     0B
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |   691B    0B |      2  1.3KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |   691B    0B |      4  2.6KB     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       1       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   34B: 64B |     88.2% |         2 |  1 (256KB) |  2 (512KB) |        98 |      0 (0B)

BLOCK CACHE: 2 entries (683B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [50%]  |                                                                   100% [50%]
  L0    50% [50%]  |  50% [25%]    50% [12%]                                           50% [12%]
-------------------+------------------------------------------------------------------------------
total     66.7%    |  50% [25%]    50% [12%]                                           83% [62%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
    1 (280B) |      66.7% |        0.0% |           1 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |   1 (660B local:660B) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |          230B |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:691 BlockBytesInCache:112 BlockReadDuration:20ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:579 BlockBytesInCache:0 BlockReadDuration:30ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}
----
----

disk-usage
----
5.0KB

# Closing iter b will release the last zombie sstable and the last zombie memtable.

iter-close b
----

metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0         0B |      0    0B |      0     0 |     0B     0B |    64B |      0    0B |   0 20.62
   L6      1.3KB |      2 1.3KB |      0     0 |     0B     0B |  1.3KB |      0    0B |   1  0.99
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      1.3KB |      2 1.3KB |      0     0 |     0B     0B |    64B |      0    0B |   1 42.09

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -     0     0 |      0    0B |    0B    0B    0B |     0B    0B |      2  1.3KB     0B
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |   691B    0B |      2  1.3KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |   691B    0B |      4  2.6KB     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       1       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   34B: 64B |     88.2% |         2 |  1 (256KB) |  1 (256KB) |        98 |      0 (0B)

BLOCK CACHE: 0 entries (0B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [50%]  |                                                                   100% [50%]
  L0    50% [50%]  |  50% [25%]    50% [12%]                                           50% [12%]
-------------------+------------------------------------------------------------------------------
total     66.7%    |  50% [25%]    50% [12%]                                           83% [62%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |      66.7% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |          230B |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:691 BlockBytesInCache:112 BlockReadDuration:20ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:579 BlockBytesInCache:0 BlockReadDuration:30ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}
----
----

disk-usage
----
4.4KB

additional-metrics
----
block bytes written:
 __level___data-block__value-block
      0         162B           0B
      1           0B           0B
      2           0B           0B
      3           0B           0B
      4           0B           0B
      5           0B           0B
      6         168B           0B

batch
set c@20 c20
set c@19 c19
set c@18 c18
set c@17 c17
set c@16 c16
set c@15 c15
set c@14 c14
----

flush
----
L0.0:
  000011:[c@20#12,SET-c@20#12,SET]
  000013:[c@19#13,SET-c@19#13,SET]
  000015:[c@18#14,SET-c@18#14,SET]
  000017:[c@17#15,SET-c@17#15,SET]
  000019:[c@16#16,SET-c@16#16,SET]
  000021:[c@15#17,SET-c@15#17,SET]
  000023:[c@14#18,SET-c@14#18,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
Blob files:
  B000012 physical:{000012 size:[177 (177B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[177 (177B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[177 (177B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[177 (177B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[177 (177B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[177 (177B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[177 (177B)] vals:[3 (3B)]}

metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0      6.4KB |      7 5.2KB |      0     0 |  1.2KB     0B |   165B |      0    0B |   1 55.05
   L6      1.3KB |      2 1.3KB |      0     0 |     0B     0B |  1.3KB |      0    0B |   1  0.99
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      7.7KB |      9 6.4KB |      0     0 |  1.2KB     0B |   165B |      0    0B |   2 63.99

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -  0.25  0.25 |      0    0B |    0B    0B    0B |     0B    0B |      9  6.5KB  2.4KB
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |   691B    0B |      2  1.3KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |   691B    0B |     11  7.9KB  2.4KB

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       1       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 116B: 165B |     42.2% |         3 |  1 (256KB) |  1 (256KB) |       281 |      0 (0B)

BLOCK CACHE: 0 entries (0B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [50%]  |                                                                   100% [50%]
  L0    50% [50%]  |  50% [25%]    50% [12%]                                           50% [12%]
-------------------+------------------------------------------------------------------------------
total     66.7%    |  50% [25%]    50% [12%]                                           83% [62%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |      66.7% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |  7 (1.2KB) |     0 (0B) |    21B | 100% (21B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            7.7KB |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |         tables |    blob files
--------------+----------------+--------------
         none |           622B |          308B
       snappy | 630B (CR=1.27) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:691 BlockBytesInCache:112 BlockReadDuration:20ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:579 BlockBytesInCache:0 BlockReadDuration:30ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}
----
----

additional-metrics
----
block bytes written:
 __level___data-block__value-block
      0         827B           0B
      1           0B           0B
      2           0B           0B
      3           0B           0B
      4           0B           0B
      5           0B           0B
      6         168B           0B

compact a-z
----
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
Blob files:
  B000012 physical:{000012 size:[177 (177B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[177 (177B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[177 (177B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[177 (177B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[177 (177B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[177 (177B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[177 (177B)] vals:[3 (3B)]}

metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0         0B |      0    0B |      0     0 |     0B     0B |   165B |      0    0B |   0 55.05
   L6      7.6KB |      9 6.4KB |      0     0 |  1.2KB     0B |  6.5KB |      0    0B |   1  1.00
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      7.6KB |      9 6.4KB |      0     0 |  1.2KB     0B |   165B |      0    0B |   1 95.93

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -     0     0 |      0    0B |    0B    0B    0B |     0B    0B |      9  6.5KB  2.4KB
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |  5.1KB    0B |      9  6.4KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |  5.1KB    0B |     18   13KB  2.4KB

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       2       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 116B: 165B |     42.2% |         3 |  1 (256KB) |  1 (256KB) |       281 |      0 (0B)

BLOCK CACHE: 0 entries (0B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [50%]  |                                                                   100% [50%]
  L0    82% [50%]  |  89% [44%]    50% [2.8%]                                          50% [2.8%]
-------------------+------------------------------------------------------------------------------
total      90%     |  89% [44%]    50% [2.8%]                                          95% [53%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |      55.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |  7 (1.2KB) |     0 (0B) |    21B | 100% (21B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |          622B |          308B
       snappy | 615B (CR=1.3) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:5234 BlockBytesInCache:112 BlockReadDuration:160ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:579 BlockBytesInCache:0 BlockReadDuration:30ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}
----
----

additional-metrics
----
block bytes written:
 __level___data-block__value-block
      0         827B           0B
      1           0B           0B
      2           0B           0B
      3           0B           0B
      4           0B           0B
      5           0B           0B
      6         818B           0B

# Flushable ingestion metrics. This requires there be data in a memtable that
# would overlap with the ingested table(s). Delayed flushes are disabled here to
# prevent the ingestion from immediately triggering a flush of the memtable.
# Instead, we wish to flush manually _after_ the ingestion of the two tables has
# completed, linking the two tables into the flushable queue.

delay-flush
enable
----

batch
set d d
set e e
set f f
----

build ext1.sst
set d d
----

build ext2.sst
set e e
----

ingest ext1.sst ext2.sst
----

build ext3.sst
set f f
----

ingest ext3.sst
----

delay-flush
disable
----

flush
----
L0.1:
  000032:[d#22,SET-d#22,SET]
  000033:[e#23,SET-e#23,SET]
  000036:[f#24,SET-f#24,SET]
L0.0:
  000040:[d#19,SET-d#19,SET]
  000041:[e#20,SET-e#20,SET]
  000042:[f#21,SET-f#21,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
Blob files:
  B000012 physical:{000012 size:[177 (177B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[177 (177B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[177 (177B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[177 (177B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[177 (177B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[177 (177B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[177 (177B)] vals:[3 (3B)]}

# We expect the ingested-as-flushable count to be three (one for each ingested
# table). The unknown category in the iter category stats is because of a gap
# in instrumentation for checking overlap with an existing flushable ingest,
# where we open and close a point iterator when constructing a range-del
# iterator.
metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0      3.9KB |      6 3.9KB |      0     0 |     0B     0B |   211B |      3 1.9KB |   2 52.43
   L6      7.6KB |      9 6.4KB |      0     0 |  1.2KB     0B |  6.5KB |      0    0B |   1  1.00
-----------------+--------------+--------------+---------------+--------+--------------+----------
total       11KB |     15  10KB |      0     0 |  1.2KB     0B |  2.1KB |      3 1.9KB |   3  9.11

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -  0.50  0.50 |      0    0B |    0B    0B    0B |     0B    0B |     12  8.4KB  2.4KB
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |  5.1KB    0B |      9  6.4KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |  5.1KB    0B |     21   17KB  2.4KB

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       2       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 176B: 211B |     19.9% |         8 |    1 (1MB) |    1 (1MB) |       387 |   2 (1.9KB)

BLOCK CACHE: 6 entries (2KB)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [65%]  |              100% [5.9%]                                          100% [59%]
  L0    82% [35%]  |  89% [31%]     50% [2%]                                            50% [2%]
-------------------+------------------------------------------------------------------------------
total     92.7%    |  89% [31%]    80% [7.8%]                                          97% [61%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |      55.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |  7 (1.2KB) |     0 (0B) |    21B | 100% (21B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
             11KB |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |         tables |    blob files
--------------+----------------+--------------
         none |            1KB |          308B
       snappy | 843B (CR=1.26) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:5234 BlockBytesInCache:112 BlockReadDuration:160ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:579 BlockBytesInCache:0 BlockReadDuration:30ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}
----
----

batch
set g g
set h h
set i i
set j j
set k k
set l l
set m m
----

flush
----
L0.1:
  000032:[d#22,SET-d#22,SET]
  000033:[e#23,SET-e#23,SET]
  000036:[f#24,SET-f#24,SET]
L0.0:
  000040:[d#19,SET-d#19,SET]
  000041:[e#20,SET-e#20,SET]
  000042:[f#21,SET-f#21,SET]
  000044:[g#25,SET-g#25,SET]
  000045:[h#26,SET-h#26,SET]
  000046:[i#27,SET-i#27,SET]
  000047:[j#28,SET-j#28,SET]
  000048:[k#29,SET-k#29,SET]
  000049:[l#30,SET-l#30,SET]
  000050:[m#31,SET-m#31,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
Blob files:
  B000012 physical:{000012 size:[177 (177B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[177 (177B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[177 (177B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[177 (177B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[177 (177B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[177 (177B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[177 (177B)] vals:[3 (3B)]}

metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0      8.4KB |     13 8.4KB |      0     0 |     0B     0B |   277B |      3 1.9KB |   2 56.62
   L6      7.6KB |      9 6.4KB |      0     0 |  1.2KB     0B |  6.5KB |      0    0B |   1  1.00
-----------------+--------------+--------------+---------------+--------+--------------+----------
total       16KB |     22  15KB |      0     0 |  1.2KB     0B |  2.2KB |      3 1.9KB |   3 10.93

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -  0.50  0.50 |      0    0B |    0B    0B    0B |     0B    0B |     19   13KB  2.4KB
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |  5.1KB    0B |      9  6.4KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |  5.1KB    0B |     28   22KB  2.4KB

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       2       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 223B: 277B |     24.2% |         9 |    1 (1MB) |    1 (1MB) |       500 |   2 (1.9KB)

BLOCK CACHE: 6 entries (2KB)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [65%]  |              100% [5.9%]                                          100% [59%]
  L0    82% [35%]  |  89% [31%]     50% [2%]                                            50% [2%]
-------------------+------------------------------------------------------------------------------
total     92.7%    |  89% [31%]    80% [7.8%]                                          97% [61%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |      55.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |  7 (1.2KB) |     0 (0B) |    21B | 100% (21B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
             16KB |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |          tables |    blob files
--------------+-----------------+--------------
         none |           1.3KB |          308B
       snappy | 1.3KB (CR=1.21) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:5234 BlockBytesInCache:112 BlockReadDuration:160ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:579 BlockBytesInCache:0 BlockReadDuration:30ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}
----
----

build ext1
set z z
----

ingest-and-excise ext1 excise=i-k
----

# sstable 29, 30 were created as virtual when i-k was excised.
lsm
----
L0.1:
  000032:[d#22,SET-d#22,SET]
  000033:[e#23,SET-e#23,SET]
  000036:[f#24,SET-f#24,SET]
L0.0:
  000040:[d#19,SET-d#19,SET]
  000041:[e#20,SET-e#20,SET]
  000042:[f#21,SET-f#21,SET]
  000044:[g#25,SET-g#25,SET]
  000045:[h#26,SET-h#26,SET]
  000048:[k#29,SET-k#29,SET]
  000049:[l#30,SET-l#30,SET]
  000050:[m#31,SET-m#31,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
  000051:[z#33,SET-z#33,SET]
Blob files:
  B000012 physical:{000012 size:[177 (177B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[177 (177B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[177 (177B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[177 (177B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[177 (177B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[177 (177B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[177 (177B)] vals:[3 (3B)]}

# There should be 2 backing tables. Note that tiny sstables have inaccurate
# virtual sstable sizes.
metrics-value
num-backing
backing-size
num-virtual
num-virtual 0
virtual-size
----
0
0B
0
0
0B

metrics zero-cache-hits-misses
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0      7.1KB |     11 7.1KB |      0     0 |     0B     0B |   277B |      3 1.9KB |   2 56.62
   L6      8.3KB |     10 7.1KB |      0     0 |  1.2KB     0B |  6.5KB |      1  655B |   1  1.00
-----------------+--------------+--------------+---------------+--------+--------------+----------
total       15KB |     21  14KB |      0     0 |  1.2KB     0B |  2.8KB |      4 2.6KB |   3  8.68

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -  0.50  0.50 |      0    0B |    0B    0B    0B |     0B    0B |     19   13KB  2.4KB
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |  5.1KB    0B |      9  6.4KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |  5.1KB    0B |     28   22KB  2.4KB

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       2       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 223B: 277B |     24.2% |         9 |    1 (1MB) |    1 (1MB) |       500 |   2 (1.9KB)

BLOCK CACHE: 0 entries (0B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
total      0%      |

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |       0.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |  7 (1.2KB) |     0 (0B) |    21B | 100% (21B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
             15KB |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |          tables |    blob files
--------------+-----------------+--------------
         none |           1.3KB |          308B
       snappy | 1.2KB (CR=1.22) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:5234 BlockBytesInCache:112 BlockReadDuration:160ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:579 BlockBytesInCache:0 BlockReadDuration:30ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}
----
----

# Virtualize a virtual sstable.
build ext1
set zz zz
----

ingest-and-excise ext1 excise=k-l
----

# sstable 32 created when k-l was excised, but no new backing file should be
# created.
lsm
----
L0.1:
  000032:[d#22,SET-d#22,SET]
  000033:[e#23,SET-e#23,SET]
  000036:[f#24,SET-f#24,SET]
L0.0:
  000040:[d#19,SET-d#19,SET]
  000041:[e#20,SET-e#20,SET]
  000042:[f#21,SET-f#21,SET]
  000044:[g#25,SET-g#25,SET]
  000045:[h#26,SET-h#26,SET]
  000049:[l#30,SET-l#30,SET]
  000050:[m#31,SET-m#31,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
  000051:[z#33,SET-z#33,SET]
  000052:[zz#35,SET-zz#35,SET]
Blob files:
  B000012 physical:{000012 size:[177 (177B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[177 (177B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[177 (177B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[177 (177B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[177 (177B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[177 (177B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[177 (177B)] vals:[3 (3B)]}

metrics-value
num-backing
backing-size
num-virtual
num-virtual 0
virtual-size
----
0
0B
0
0
0B

compact a-z
----
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000025:[c@20#0,SET-c@20#0,SET]
  000026:[c@19#0,SET-c@19#0,SET]
  000027:[c@18#0,SET-c@18#0,SET]
  000028:[c@17#0,SET-c@17#0,SET]
  000029:[c@16#0,SET-c@16#0,SET]
  000030:[c@15#0,SET-c@15#0,SET]
  000031:[c@14#0,SET-c@14#0,SET]
  000053:[d#0,SET-d#0,SET]
  000054:[e#0,SET-e#0,SET]
  000055:[f#0,SET-f#0,SET]
  000056:[g#0,SET-g#0,SET]
  000057:[h#0,SET-h#0,SET]
  000058:[l#0,SET-l#0,SET]
  000059:[m#0,SET-m#0,SET]
  000051:[z#33,SET-z#33,SET]
  000052:[zz#35,SET-zz#35,SET]
Blob files:
  B000012 physical:{000012 size:[177 (177B)] vals:[3 (3B)]}
  B000014 physical:{000014 size:[177 (177B)] vals:[3 (3B)]}
  B000016 physical:{000016 size:[177 (177B)] vals:[3 (3B)]}
  B000018 physical:{000018 size:[177 (177B)] vals:[3 (3B)]}
  B000020 physical:{000020 size:[177 (177B)] vals:[3 (3B)]}
  B000022 physical:{000022 size:[177 (177B)] vals:[3 (3B)]}
  B000024 physical:{000024 size:[177 (177B)] vals:[3 (3B)]}

# Virtual sstables metrics should be gone after the compaction.
metrics-value
num-backing
backing-size
num-virtual
num-virtual 0
virtual-size
----
0
0B
0
0
0B

metrics zero-cache-hits-misses
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0         0B |      0    0B |      0     0 |     0B     0B |   277B |      3 1.9KB |   0 56.62
   L6       13KB |     18  12KB |      0     0 |  1.2KB     0B |   13KB |      2 1.3KB |   1  0.85
-----------------+--------------+--------------+---------------+--------+--------------+----------
total       13KB |     18  12KB |      0     0 |  1.2KB     0B |  3.5KB |      5 3.2KB |   1  8.56

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -     0     0 |      0    0B |    0B    0B    0B |     0B    0B |     19   13KB  2.4KB
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |   11KB    0B |     16   11KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |   11KB    0B |     35   27KB  2.4KB

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       3       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) | 223B: 277B |     24.2% |         9 |    1 (1MB) |    1 (1MB) |       500 |   2 (1.9KB)

BLOCK CACHE: 0 entries (0B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
total      0%      |

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |       0.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |  7 (1.2KB) |     0 (0B) |    21B | 100% (21B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |         1.5KB |          308B
       snappy | 682B (CR=1.3) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:11009 BlockBytesInCache:457 BlockReadDuration:330ms}
                   a, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
                   b,     latency: {BlockBytes:579 BlockBytesInCache:0 BlockReadDuration:30ms}
                   c, non-latency: {BlockBytes:112 BlockBytesInCache:112 BlockReadDuration:0s}
----
----

# Create a DB where lower levels are written as shared tables. All ingests also
# become shared tables.
init shared-lower
----

batch
set a 1
set b 1
set c 1
----

flush
----
L0.0:
  000005:[a#10,SET-a#10,SET]
  000006:[b#11,SET-b#11,SET]
  000007:[c#12,SET-c#12,SET]

# One local table.
metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0      1.9KB |      3 1.9KB |      0     0 |     0B     0B |    38B |      0    0B |   1 52.11
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      1.9KB |      3 1.9KB |      0     0 |     0B     0B |    38B |      0    0B |   1 53.11

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -  0.25  0.25 |      0    0B |    0B    0B    0B |     0B    0B |      3  1.9KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |     0B    0B |      3    2KB     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       0       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   27B: 38B |     40.7% |         1 |  1 (256KB) |  1 (256KB) |        65 |      0 (0B)

BLOCK CACHE: 0 entries (0B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
total      0%      |

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |       0.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |         tables |    blob files
--------------+----------------+--------------
         none |           108B |
       snappy | 228B (CR=1.14) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
----
----

compact a-z
----
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000010:[c#0,SET-c#0,SET]

# Table becomes shared, so local table size becomes 0.
metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0         0B |      0    0B |      0     0 |     0B     0B |    38B |      0    0B |   0 52.11
   L6      1.9KB |      3 1.9KB |      0     0 |     0B     0B |  1.9KB |      0    0B |   1  0.99
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      1.9KB |      3 1.9KB |      0     0 |     0B     0B |    38B |      0    0B |   1 104.8

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -     0     0 |      0    0B |    0B    0B    0B |     0B    0B |      3  1.9KB     0B
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |  1.7KB    0B |      3  1.9KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |  1.7KB    0B |      6  3.9KB     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       1       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   27B: 38B |     40.7% |         1 |  1 (256KB) |  1 (256KB) |        65 |      0 (0B)

BLOCK CACHE: 0 entries (0B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [50%]  |                                                                   100% [50%]
  L0   100% [50%]  |  100% [50%]
-------------------+------------------------------------------------------------------------------
total     100%     |  100% [50%]                                                       100% [50%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |      50.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |          345B |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:1737 BlockBytesInCache:0 BlockReadDuration:60ms}
----
----

build ext1.sst
set b 2
----

ingest ext1.sst
----

metrics-value
remote-count
remote-size
----
4
2.6KB

lsm
----
L0.0:
  000011:[b#13,SET-b#13,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000010:[c#0,SET-c#0,SET]

# Ingest is also shared table, so local table size stays 0.
metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0       655B |      1  655B |      0     0 |     0B     0B |    38B |      1  655B |   1 52.11
   L6      1.9KB |      3 1.9KB |      0     0 |     0B     0B |  1.9KB |      0    0B |   1  0.99
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      2.6KB |      4 2.6KB |      0     0 |     0B     0B |   693B |      1  655B |   2  6.69

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -  0.25  0.25 |      0    0B |    0B    0B    0B |     0B    0B |      3  1.9KB     0B
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |  1.7KB    0B |      3  1.9KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |  1.7KB    0B |      6  4.5KB     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       1       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   27B: 38B |     40.7% |         1 |  1 (256KB) |  1 (256KB) |        65 |      0 (0B)

BLOCK CACHE: 2 entries (675B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [65%]  |              100% [5.9%]                                          100% [59%]
  L0   100% [35%]  |  100% [35%]
-------------------+------------------------------------------------------------------------------
total     100%     |  100% [35%]  100% [5.9%]                                          100% [59%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |      50.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            2.6KB |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |          460B |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:1737 BlockBytesInCache:0 BlockReadDuration:60ms}
----
----

batch
set b 3
----

flush
----
L0.1:
  000013:[b#14,SET-b#14,SET]
L0.0:
  000011:[b#13,SET-b#13,SET]
L6:
  000008:[a#0,SET-a#0,SET]
  000009:[b#0,SET-b#0,SET]
  000010:[c#0,SET-c#0,SET]

# Local table size increases due to flush.
metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0      1.3KB |      2 1.3KB |      0     0 |     0B     0B |    74B |      1  655B |   2 35.68
   L6      1.9KB |      3 1.9KB |      0     0 |     0B     0B |  1.9KB |      0    0B |   1  0.99
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      3.2KB |      5 3.2KB |      0     0 |     0B     0B |   729B |      1  655B |   3  7.32

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -  0.50  0.50 |      0    0B |    0B    0B    0B |     0B    0B |      4  2.6KB     0B
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |  1.7KB    0B |      3  1.9KB     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |  1.7KB    0B |      7  5.2KB     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       1       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |   44B: 74B |     68.2% |         2 |  1 (256KB) |  1 (256KB) |       118 |      0 (0B)

BLOCK CACHE: 2 entries (675B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [65%]  |              100% [5.9%]                                          100% [59%]
  L0   100% [35%]  |  100% [35%]
-------------------+------------------------------------------------------------------------------
total     100%     |  100% [35%]  100% [5.9%]                                          100% [59%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |      50.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            3.2KB |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |          496B |
       snappy | 76B (CR=1.14) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:1737 BlockBytesInCache:0 BlockReadDuration:60ms}
----
----

# Reopen DB, to ensure stats are consistent. Also, reopened DB is not
# configured to write shared tables.
init reopen
----

metrics zero-cache-hits-misses
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0      1.3KB |      2 1.3KB |      0     0 |     0B     0B |     0B |      0    0B |   2     0
   L6      1.9KB |      3 1.9KB |      0     0 |     0B     0B |     0B |      0    0B |   1     0
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      3.2KB |      5 3.2KB |      0     0 |     0B     0B |     0B |      0    0B |   3     0

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -  0.50  0.50 |      0    0B |    0B    0B    0B |     0B    0B |      0     0B     0B
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |     0B    0B |      0     0B     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |     0B    0B |      0     0B     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       0       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |     0B: 0B |      0.0% |         1 |  1 (512KB) |  1 (256KB) |         0 |      0 (0B)

BLOCK CACHE: 0 entries (0B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
total      0%      |

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |       0.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            3.2KB |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |          496B |
       snappy | 76B (CR=1.14) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
----
----

compact a-z
----
L6:
  000008:[a#0,SET-a#0,SET]
  000018:[b#0,SET-b#0,SET]
  000010:[c#0,SET-c#0,SET]

# All tables are local after compaction.
metrics zero-cache-hits-misses
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L6      1.9KB |      3 1.9KB |      0     0 |     0B     0B |  1.3KB |      0    0B |   1  0.50
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      1.9KB |      3 1.9KB |      0     0 |     0B     0B |     0B |      0    0B |   1     0

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L6 |     -  0.00  0.00 |      0    0B |    0B    0B    0B |   342B    0B |      1   655B     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      0    0B |    0B    0B    0B |   342B    0B |      1   655B     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       1       0        0     0     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |     0B: 0B |      0.0% |         1 |  1 (512KB) |  1 (256KB) |         0 |      0 (0B)

BLOCK CACHE: 0 entries (0B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
total      0%      |

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
      0 (0B) |       0.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
               0B |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                0 |                        0 |              0B |              0B

COMPRESSION
    algorithm |        tables |    blob files
--------------+---------------+--------------
         none |          345B |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:342 BlockBytesInCache:0 BlockReadDuration:30ms}
----
----

init
----

batch
set a 1
set b 2
----

flush
----
L0.0:
  000005:[a#10,SET-a#10,SET]
  000006:[b#11,SET-b#11,SET]

batch
del-sized c 500
----

flush
----
L0.0:
  000005:[a#10,SET-a#10,SET]
  000006:[b#11,SET-b#11,SET]
  000008:[c#12,DELSIZED-c#12,DELSIZED]

compact a-z parallel
----
L6:
  000005:[a#10,SET-a#10,SET]
  000006:[b#11,SET-b#11,SET]
  000008:[c#12,DELSIZED-c#12,DELSIZED]

batch
del-range a c
----

flush
----
L0.0:
  000010:[a#13,RANGEDEL-b#inf,RANGEDEL]
  000011:[b#13,RANGEDEL-c#inf,RANGEDEL]
L6:
  000005:[a#10,SET-a#10,SET]
  000006:[b#11,SET-b#11,SET]
  000008:[c#12,DELSIZED-c#12,DELSIZED]

metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0      1.3KB |      2 1.3KB |      0     0 |     0B     0B |   106B |      0    0B |   1 31.35
   L6        2KB |      3   2KB |      0     0 |     0B     0B |     0B |      0    0B |   1     0
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      3.2KB |      5 3.2KB |      0     0 |     0B     0B |   106B |      0    0B |   2 32.35

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -  0.25  0.25 |      0    0B |    0B    0B    0B |     0B    0B |      5  3.2KB     0B
   L6 |     -  0.00  0.00 |      3   2KB |    0B    0B    0B |     0B    0B |      0     0B     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      3   2KB |    0B    0B    0B |     0B    0B |      5  3.3KB     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       0       0        0     3     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |  57B: 106B |     86.0% |         3 |  1 (256KB) |  1 (256KB) |       163 |      0 (0B)

BLOCK CACHE: 2 entries (662B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [100%] |               100% [33%]                                          100% [67%]
-------------------+------------------------------------------------------------------------------
total     100%     |               100% [33%]                                          100% [67%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
    2 (560B) |       0.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            3.2KB |            0 (0B) |            0 (0B) |                 0 |                  0

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                3 |                        0 |            502B |           1.3KB

COMPRESSION
    algorithm |         tables |    blob files
--------------+----------------+--------------
         none |           266B |
       snappy | 221B (CR=1.19) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
----
----

problem-spans
L0 [a, c)
L6 [u, v]
----

metrics
----
----
LSM                             |    vtables   |   value sep   |        |   ingested   |    amp
level       size | tables  size |  count  size |  refsz valblk |     in | tables  size |   r     w
-----------------+--------------+--------------+---------------+--------+--------------+----------
   L0      1.3KB |      2 1.3KB |      0     0 |     0B     0B |   106B |      0    0B |   1 31.35
   L6        2KB |      3   2KB |      0     0 |     0B     0B |     0B |      0    0B |   1     0
-----------------+--------------+--------------+---------------+--------+--------------+----------
total      3.2KB |      5 3.2KB |      0     0 |     0B     0B |   106B |      0    0B |   2 32.35

COMPACTIONS               |     moved    |     multilevel    |     read     |       written
level | score    ff   cff | tables  size |   top    in  read | tables  blob | tables  sstsz blobsz
------+-------------------+--------------+-------------------+--------------+---------------------
   L0 |     -  0.25  0.25 |      0    0B |    0B    0B    0B |     0B    0B |      5  3.2KB     0B
   L6 |     -  0.00  0.00 |      3   2KB |    0B    0B    0B |     0B    0B |      0     0B     0B
------+-------------------+--------------+-------------------+--------------+---------------------
total |     -     -     - |      3   2KB |    0B    0B    0B |     0B    0B |      5  3.3KB     0B

 kind | default  delete  elision  move  read  tomb  rewrite  copy  multi  blob virtual
count |       0       0        0     3     0     0        0     0      0     0       0

COMMIT PIPELINE
               wals                |              memtables              |       ingestions
    files |    written |  overhead |   flushes |       live |     zombie |     total |   flushable
----------+------------+-----------+-----------+------------+------------+-----------+------------
   1 (0B) |  57B: 106B |     86.0% |         3 |  1 (256KB) |  1 (256KB) |       163 |      0 (0B)

BLOCK CACHE: 2 entries (662B)
                 miss rate [percentage of total misses] since start
level      all     |  background    sstdata       sstval      blobval       filter       index
-------------------+------------------------------------------------------------------------------
 n/a   100% [100%] |               100% [33%]                                          100% [67%]
-------------------+------------------------------------------------------------------------------
total     100%     |               100% [33%]                                          100% [67%]

ITERATORS
        file cache        |    filter   |    open     |    open
     entries |   hit rate | utilization |  sst iters  |  snapshots
-------------+------------+-------------+-------------+------------
    2 (560B) |       0.0% |        0.0% |           0 |           0

FILES                 tables                       |       blob files        |     blob values
   stats prog |    backing |                zombie |       live |     zombie |  total |      refed
--------------+------------+-----------------------+------------+------------+--------+-----------
   all loaded |     0 (0B) |       0 (0B local:0B) |     0 (0B) |     0 (0B) |     0B |    0% (0B)

CGO MEMORY    |          block cache           |                     memtables
          tot |           tot |           data |            maps |            ents |           tot
--------------+---------------+----------------+-----------------+-----------------+--------------
           0B |            0B |             0B |              0B |              0B |            0B

COMPACTIONS
   estimated debt |       in progress |         cancelled |            failed |      problem spans
------------------+-------------------+-------------------+-------------------+-------------------
            3.2KB |            0 (0B) |            0 (0B) |                 0 |                2!!

KEYS
      range keys |       tombstones |      missized tombstones |      point dels |      range dels
-----------------+------------------+--------------------------+-----------------+----------------
               0 |                3 |                        0 |            502B |           1.3KB

COMPRESSION
    algorithm |         tables |    blob files
--------------+----------------+--------------
         none |           266B |
       snappy | 221B (CR=1.19) |

Iter category stats:
   pebble-compaction, non-latency: {BlockBytes:0 BlockBytesInCache:0 BlockReadDuration:0s}
----
----
