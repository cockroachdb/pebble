build-remote file1
set a avalue
set b bvalue
set f cvalue
----

build-remote file2-not-there
set d#0 dvalue
set q#0 qvalue
set w#0 wvalue
----

build-remote file3
set x#0 xvalue
set y#0 yvalue
set z#0 zvalue
----

ingest-external
file1 bounds=(a,c0)
file2 bounds=(d,w0)
file3 bounds=(x,z0)
----

start-workload
----

# Verify that a problem span is set.
wait-for-problem-span
----

# Verify that compactions still go through.
wait-for-compactions
----

# Make file2 appear.
move-remote-object file2-not-there file2
----
file2-not-there -> file2

# Expire spans.
expire-spans
----

# Compactions should now go through and eventually there should be no external
# files.
wait-for-no-external-files
----

build-remote file4-not-there
set a#0 avalue
set u#0 uvalue
set z#0 zvalue
----

ingest-external
file4 bounds=(a,z0)
----

# Verify that a problem span is set.
wait-for-problem-span
----

stop-workload
----

# Make file4 appear.
move-remote-object file4-not-there file4
----
file4-not-there -> file4

# Verify that a manual compaction goes through despite the problem span.
manual-compaction
----
